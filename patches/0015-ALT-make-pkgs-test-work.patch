From 934cbbc79465d571d390ab1fe324ff1a62616693 Mon Sep 17 00:00:00 2001
From: "Vladimir D. Seleznev" <vseleznv@altlinux.org>
Date: Tue, 8 Oct 2019 18:35:46 +0300
Subject: [PATCH 15/17] ALT make pkgs test work

---
 tcl/pkgs/itcl4.2.0/Makefile.in         | 3 ++-
 tcl/pkgs/sqlite3.29.0/Makefile.in      | 2 +-
 tcl/pkgs/tdbc1.1.1/Makefile.in         | 3 ++-
 tcl/pkgs/tdbcmysql1.1.1/Makefile.in    | 3 ++-
 tcl/pkgs/tdbcodbc1.1.1/Makefile.in     | 3 ++-
 tcl/pkgs/tdbcpostgres1.1.1/Makefile.in | 3 ++-
 tcl/pkgs/tdbcsqlite3-1.1.1/Makefile.in | 3 ++-
 tcl/pkgs/thread2.8.5/Makefile.in       | 3 ++-
 tcl/unix/Makefile.in                   | 2 +-
 9 files changed, 16 insertions(+), 9 deletions(-)

diff --git a/tcl/pkgs/itcl4.2.0/Makefile.in b/tcl/pkgs/itcl4.2.0/Makefile.in
index 00b31d8e16..e876bbb03a 100644
--- a/tcl/pkgs/itcl4.2.0/Makefile.in
+++ b/tcl/pkgs/itcl4.2.0/Makefile.in
@@ -132,7 +132,7 @@ TCL_SRC_DIR	= @TCL_SRC_DIR@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  ITCL_LIBRARY=`@CYGPATH@ $(srcdir)/library` \
@@ -289,6 +289,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/sqlite3.29.0/Makefile.in b/tcl/pkgs/sqlite3.29.0/Makefile.in
index 6ae745ff26..7edfb0e48a 100644
--- a/tcl/pkgs/sqlite3.29.0/Makefile.in
+++ b/tcl/pkgs/sqlite3.29.0/Makefile.in
@@ -132,7 +132,7 @@ TCL_SRC_DIR	= @TCL_SRC_DIR@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library` \
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY) \
 		  @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TCLLIBPATH="$(TCLLIBPATH)"
diff --git a/tcl/pkgs/tdbc1.1.1/Makefile.in b/tcl/pkgs/tdbc1.1.1/Makefile.in
index 054a06ece7..edf312b900 100644
--- a/tcl/pkgs/tdbc1.1.1/Makefile.in
+++ b/tcl/pkgs/tdbc1.1.1/Makefile.in
@@ -130,7 +130,7 @@ TCL_SRC_DIR	= @TCL_SRC_DIR@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TDBC_LIBRARY=`@CYGPATH@ $(srcdir)/library` \
@@ -281,6 +281,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/tdbcmysql1.1.1/Makefile.in b/tcl/pkgs/tdbcmysql1.1.1/Makefile.in
index 93cbcaa2f8..d0d7486b05 100644
--- a/tcl/pkgs/tdbcmysql1.1.1/Makefile.in
+++ b/tcl/pkgs/tdbcmysql1.1.1/Makefile.in
@@ -135,7 +135,7 @@ TDBC_LIB_FILE	= @TDBC_LIB_FILE@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir) $(TDBC_BIN_DIR)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TDBC_LIBRARY=`@CYGPATH@ @tdbc_LIBRARY_PATH@` \
@@ -285,6 +285,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/tdbcodbc1.1.1/Makefile.in b/tcl/pkgs/tdbcodbc1.1.1/Makefile.in
index 435228a36e..3ca3cf0077 100644
--- a/tcl/pkgs/tdbcodbc1.1.1/Makefile.in
+++ b/tcl/pkgs/tdbcodbc1.1.1/Makefile.in
@@ -135,7 +135,7 @@ TDBC_LIB_FILE	= @TDBC_LIB_FILE@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir) $(TDBC_BIN_DIR)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TDBCODBC_LIBRARY=`@CYGPATH@ $(srcdir)/library` \
@@ -298,6 +298,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/tdbcpostgres1.1.1/Makefile.in b/tcl/pkgs/tdbcpostgres1.1.1/Makefile.in
index dc0a529402..6a25611768 100644
--- a/tcl/pkgs/tdbcpostgres1.1.1/Makefile.in
+++ b/tcl/pkgs/tdbcpostgres1.1.1/Makefile.in
@@ -135,7 +135,7 @@ TDBC_LIB_FILE	= @TDBC_LIB_FILE@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir) $(TDBC_BIN_DIR)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TDBC_LIBRARY=`@CYGPATH@ @tdbc_LIBRARY_PATH@` \
@@ -285,6 +285,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/tdbcsqlite3-1.1.1/Makefile.in b/tcl/pkgs/tdbcsqlite3-1.1.1/Makefile.in
index b65ef37547..9aa7f8b03b 100644
--- a/tcl/pkgs/tdbcsqlite3-1.1.1/Makefile.in
+++ b/tcl/pkgs/tdbcsqlite3-1.1.1/Makefile.in
@@ -134,7 +134,7 @@ TDBC_LIB_FILE	= @TDBC_LIB_FILE@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir) $(TDBC_BIN_DIR)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
 		  TDBC_LIBRARY=`@CYGPATH@ @tdbc_LIBRARY_PATH@` \
@@ -291,6 +291,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/pkgs/thread2.8.5/Makefile.in b/tcl/pkgs/thread2.8.5/Makefile.in
index 1355ab6199..b80ec8074d 100644
--- a/tcl/pkgs/thread2.8.5/Makefile.in
+++ b/tcl/pkgs/thread2.8.5/Makefile.in
@@ -130,7 +130,7 @@ TCL_SRC_DIR	= @TCL_SRC_DIR@
 EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR)
 #EXTRA_PATH	= $(top_builddir):$(TCL_BIN_DIR):$(TK_BIN_DIR)
 TCLLIBPATH	= $(top_builddir)
-TCLSH_ENV	= TCL_LIBRARY=`@CYGPATH@ $(TCL_SRC_DIR)/library`
+TCLSH_ENV	= TCL_LIBRARY=$(TCL_LIBRARY)
 PKG_ENV		= TCL_THREAD_LIBRARY=`@CYGPATH@ $(srcdir)/lib` \
 		  @LD_LIBRARY_PATH_VAR@="$(EXTRA_PATH):$(@LD_LIBRARY_PATH_VAR@)" \
 		  PATH="$(EXTRA_PATH):$(PATH)" \
@@ -270,6 +270,7 @@ $(PKG_LIB_FILE): $(PKG_OBJECTS)
 	-rm -f $(PKG_LIB_FILE)
 	${MAKE_LIB}
 	$(RANLIB) $(PKG_LIB_FILE)
+	ln -rs $(PKG_LIB_FILE) ..
 
 $(PKG_STUB_LIB_FILE): $(PKG_STUB_OBJECTS)
 	-rm -f $(PKG_STUB_LIB_FILE)
diff --git a/tcl/unix/Makefile.in b/tcl/unix/Makefile.in
index bfe8a9b912..2528f1d114 100644
--- a/tcl/unix/Makefile.in
+++ b/tcl/unix/Makefile.in
@@ -237,7 +237,7 @@ PKGS_DIR		= $(TOP_DIR)/pkgs
 # Must be absolute because of the cd dltest $(DLTEST_DIR)/configure below.
 DLTEST_DIR		= @TCL_SRC_DIR@/unix/dltest
 # Must be absolute to so the corresponding tcltest's tcl_library is absolute.
-TCL_BUILDTIME_LIBRARY	= @TCL_SRC_DIR@/library
+TCL_BUILDTIME_LIBRARY	= $(TOP_DIR)/library
 
 ZLIB_DIR		= ${COMPAT_DIR}/zlib
 ZLIB_INCLUDE		= @ZLIB_INCLUDE@
-- 
2.21.0

